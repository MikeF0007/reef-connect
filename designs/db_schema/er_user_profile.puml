@startuml
' User & User Profile ER Diagram

hide circle
skinparam linetype ortho
skinparam shadowing false
skinparam entity {
  BackgroundColor #F8FAFC
  BorderColor #1E293B
  FontColor #0F172A
}

entity "users" as users {
  *id : uuid
  --
  *email : text
  *username : text
  *password_hash : text
  email_verified : boolean
  email_verified_at : timestamptz
  auth_providers : jsonb
  mfa_enabled : boolean
  mfa_secret : text
  *created_at : timestamptz
  *updated_at : timestamptz
}

entity "user_profiles" as user_profiles {
  *id : uuid
  *user_id : uuid
  --
  bio : text
  avatar_url : text
  avatar_storage_key : text
  first_name : text
  last_name : text
  location : text
  website_url : text
  birth_date : date
  certifications : jsonb
  *created_at : timestamptz
  *updated_at : timestamptz
}

entity "user_settings" as user_settings {
  *id : uuid
  *user_id : uuid
  --
  preferred_units : text (imperial | metric)
  timezone : text
  language : text
  *created_at : timestamptz
  *updated_at : timestamptz
}

entity "privacy_settings" as privacy_settings {
  *id : uuid
  *user_id : uuid
  --
  profile_visibility : text (public | private)
  dive_logs_visibility : text (public | private)
  media_visibility : text (public | private)
  stats_visibility : text (public | private)
  *created_at : timestamptz
  *updated_at : timestamptz
}

entity "user_certifications" as user_certifications {
  *id : uuid
  *user_id : uuid
  --
  *certification_name : text
  *issuer : text
  *issued_date : date
  expiry_date : date
  certification_number : text
  notes : text
  verified : boolean
  *created_at : timestamptz
}


' Relationships
users ||--|| user_profiles : "1:1"
users ||--|| user_settings : "1:1"
users ||--|| privacy_settings : "1:1"
users ||--o{ user_certifications : "1:many"

note bottom of users
  TODO: Tentative plan, need to formalize in sequence diagram
  **Deletion Cascade Behavior:**
  - Anonymize social data: replace display_name with "Deleted User"
  - Keep social relationships but anonymize interactions
  - Leaderboards: remove immediately on deletion
end note

@enduml
